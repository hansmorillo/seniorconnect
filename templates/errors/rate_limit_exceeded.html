<!-- templates/errors/rate_limit_exceeded.html -->
{% extends "base.html" %}

{% block title %}Rate Limit Exceeded{% endblock %}

{% block content %}
<div class="container mt-5">
    <div class="rate-limit-error-container">
        <div class="error-card">
            <div class="error-icon">
                <i class="fas fa-clock text-warning"></i>
            </div>
            
            <div class="error-content">
                <h2 class="error-title">Rate Limit Exceeded</h2>
                <p class="error-message">
                    You've made too many requests in a short period of time. 
                    Please wait a moment before trying again.
                </p>
                
                <div class="error-details">
                    <div class="detail-item">
                        <i class="fas fa-info-circle"></i>
                        <span>This protection helps keep our services running smoothly for everyone.</span>
                    </div>
                    
                    <div class="detail-item">
                        <i class="fas fa-shield-alt"></i>
                        <span>Rate limiting prevents abuse and ensures fair usage of resources.</span>
                    </div>
                    
                    {% if description %}
                    <div class="detail-item">
                        <i class="fas fa-exclamation-triangle"></i>
                        <span class="text-muted">{{ description }}</span>
                    </div>
                    {% endif %}
                </div>
                
                <div class="error-actions">
                    <button onclick="history.back()" class="btn btn-secondary">
                        <i class="fas fa-arrow-left me-2"></i>Go Back
                    </button>
                    
                    <a href="{{ url_for('user.dashboard') if current_user.is_authenticated else url_for('home') }}" 
                       class="btn btn-primary">
                        <i class="fas fa-home me-2"></i>
                        {% if current_user.is_authenticated %}Dashboard{% else %}Home{% endif %}
                    </a>
                </div>
                
                <div class="countdown-container mt-4">
                    <p class="text-muted mb-2">You can try again in:</p>
                    <div class="countdown-timer" id="countdown">
                        <span class="countdown-number">60</span>
                        <span class="countdown-text">seconds</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
/* Rate Limit Error Styling */
.rate-limit-error-container {
    display: flex;
    justify-content: center;
    align-items: center;
    min-height: 60vh;
    padding: 2rem 0;
}

.error-card {
    background: linear-gradient(135deg, #fff8e1 0%, #ffffff 100%);
    border: 2px solid #ffb74d;
    border-radius: 16px;
    padding: 3rem;
    text-align: center;
    box-shadow: 0 8px 25px rgba(255, 183, 77, 0.2);
    max-width: 600px;
    width: 100%;
    animation: fadeInUp 0.6s ease-out;
}

.error-icon {
    font-size: 4rem;
    margin-bottom: 1.5rem;
}

.error-title {
    color: #e65100;
    font-weight: 700;
    margin-bottom: 1rem;
    font-size: 2rem;
}

.error-message {
    color: #bf360c;
    font-size: 1.1rem;
    margin-bottom: 2rem;
    line-height: 1.6;
}

.error-details {
    background: rgba(255, 183, 77, 0.1);
    border-radius: 12px;
    padding: 1.5rem;
    margin: 2rem 0;
    text-align: left;
}

.detail-item {
    display: flex;
    align-items: center;
    margin-bottom: 1rem;
    color: #d84315;
}

.detail-item:last-child {
    margin-bottom: 0;
}

.detail-item i {
    margin-right: 0.75rem;
    font-size: 1.1rem;
    color: #ff9800;
    min-width: 20px;
}

.error-actions {
    display: flex;
    gap: 1rem;
    justify-content: center;
    margin: 2rem 0;
    flex-wrap: wrap;
}

.btn {
    border-radius: 25px;
    padding: 0.75rem 2rem;
    font-weight: 600;
    transition: all 0.3s ease;
}

.btn-secondary {
    background: linear-gradient(135deg, #757575 0%, #9e9e9e 100%);
    border: none;
    color: white;
}

.btn-secondary:hover {
    background: linear-gradient(135deg, #616161 0%, #757575 100%);
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(117, 117, 117, 0.3);
}

.btn-primary {
    background: linear-gradient(135deg, #1976d2 0%, #42a5f5 100%);
    border: none;
    color: white;
}

.btn-primary:hover {
    background: linear-gradient(135deg, #1565c0 0%, #1976d2 100%);
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(25, 118, 210, 0.3);
}

.countdown-container {
    background: rgba(255, 152, 0, 0.1);
    border-radius: 12px;
    padding: 1.5rem;
    border: 1px solid rgba(255, 152, 0, 0.3);
}

.countdown-timer {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
}

.countdown-number {
    background: linear-gradient(135deg, #ff9800 0%, #ffb74d 100%);
    color: white;
    padding: 0.5rem 1rem;
    border-radius: 8px;
    font-weight: 700;
    font-size: 1.5rem;
    min-width: 60px;
}

.countdown-text {
    color: #e65100;
    font-weight: 600;
}

/* Responsive Design */
@media (max-width: 768px) {
    .error-card {
        padding: 2rem 1.5rem;
        margin: 0 1rem;
    }
    
    .error-actions {
        flex-direction: column;
        align-items: stretch;
    }
    
    .error-title {
        font-size: 1.5rem;
    }
    
    .error-icon {
        font-size: 3rem;
    }
}

/* Animation */
@keyframes fadeInUp {
    from {
        opacity: 0;
        transform: translateY(30px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

/* Pulsing effect for countdown */
@keyframes pulse {
    0% { transform: scale(1); }
    50% { transform: scale(1.05); }
    100% { transform: scale(1); }
}

.countdown-number {
    animation: pulse 2s ease-in-out infinite;
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Countdown timer
    let timeLeft = 60;
    const countdownElement = document.querySelector('.countdown-number');
    const refreshButton = document.createElement('button');
    
    if (countdownElement) {
        const timer = setInterval(function() {
            timeLeft--;
            countdownElement.textContent = timeLeft;
            
            if (timeLeft <= 0) {
                clearInterval(timer);
                countdownElement.textContent = '0';
                
                // Show refresh button
                refreshButton.className = 'btn btn-success mt-3';
                refreshButton.innerHTML = '<i class="fas fa-refresh me-2"></i>Try Again';
                refreshButton.onclick = function() {
                    window.location.reload();
                };
                
                const countdownContainer = document.querySelector('.countdown-container');
                countdownContainer.appendChild(refreshButton);
                
                // Change countdown styling
                countdownElement.style.background = 'linear-gradient(135deg, #4caf50 0%, #66bb6a 100%)';
                document.querySelector('.countdown-text').textContent = 'ready!';
            }
        }, 1000);
    }
    
    // Auto-refresh after countdown (optional)
    setTimeout(function() {
        const autoRefreshNotice = document.createElement('div');
        autoRefreshNotice.className = 'alert alert-info mt-3';
        autoRefreshNotice.innerHTML = '<i class="fas fa-info-circle me-2"></i>You may now try your request again.';
        
        const errorCard = document.querySelector('.error-card');
        if (errorCard) {
            errorCard.appendChild(autoRefreshNotice);
        }
    }, 60000);
});
</script>

<!-- FontAwesome for icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
{% endblock %}

<!-- Alternative simpler template -->
<!-- templates/errors/429.html -->
{% extends "base.html" %}

{% block title %}Too Many Requests{% endblock %}

{% block content %}
<div class="container mt-5">
    <div class="text-center">
        <div class="error-429">
            <i class="fas fa-exclamation-triangle text-warning" style="font-size: 4rem;"></i>
            <h2 class="mt-3">Rate Limit Exceeded</h2>
            <p class="lead text-muted">You're making requests too quickly. Please wait a moment and try again.</p>
            
            {% if description %}
                <div class="alert alert-warning mt-3">
                    {{ description }}
                </div>
            {% endif %}
            
            <div class="mt-4">
                <a href="javascript:history.back()" class="btn btn-secondary me-2">
                    <i class="fas fa-arrow-left"></i> Go Back
                </a>
                <a href="{{ url_for('home') }}" class="btn btn-primary">
                    <i class="fas fa-home"></i> Home
                </a>
            </div>
        </div>
    </div>
</div>
{% endblock %}